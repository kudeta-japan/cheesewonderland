<!doctype html>
<html lang="ja">
<head>
  <!-- =============================================
    Cheese Wonderland ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆï¼ˆFormspreeç‰ˆãƒ»1ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
    ä½¿ã„æ–¹ï¼š
      1) Formspreeã§ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆ â†’ ãƒ•ã‚©ãƒ¼ãƒ IDã‚’å–å¾—ï¼ˆä¾‹ï¼šf/abcdwxyzï¼‰
      2) ä¸‹ã® FORM_ID_HERE ã‚’ã‚ãªãŸã®IDã«ç½®ãæ›ãˆ
      3) ä»»æ„ã§ã€Œç‰¹å…¸ã‚³ãƒ¼ãƒ‰ã€ã€Œé€ä¿¡å¾Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã‚’å¤‰æ›´
      4) ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚µãƒ¼ãƒãƒ¼/Netlify/GitHub Pages ãªã©ã§å…¬é–‹
  ============================================== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cheese Wonderland ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ</title>
  <meta name="description" content="Cheese Wonderland ã”å‚åŠ è€…ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆï¼ˆæ‰€è¦60ç§’ã€œ3åˆ†ï¼åŒ¿åï¼‰" />
  <style>
    :root{
      --bg:#0b0c10; --fg:#f7f7f7; --muted:#b5b5b5; --brand:#ffd54d; --brand2:#ffb300; --card:#14161a; --ok:#31c48d; --warn:#f59e0b;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif; background:radial-gradient(1200px 800px at 70% -20%, rgba(255,213,77,.15), transparent), var(--bg); color:var(--fg);}
    .wrap{max-width:880px; margin:0 auto; padding:28px 18px 56px;}
    header{display:flex; align-items:center; gap:12px; margin-bottom:18px}
    .logo{width:40px; height:40px; border-radius:12px; background:linear-gradient(135deg,var(--brand),var(--brand2)); box-shadow:0 6px 18px rgba(255,181,0,.25);}
    h1{font-size: clamp(1.2rem, 2.4vw, 1.8rem); margin:0}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.0)); border:1px solid rgba(255,255,255,.06); box-shadow:0 10px 30px rgba(0,0,0,.25); border-radius:18px; padding:18px; margin:14px 0;}
    .muted{color:var(--muted); font-size:.95rem}
    .grid{display:grid; gap:12px}
    .two{grid-template-columns:1fr 1fr}
    label{display:block; font-weight:600; margin:6px 0 8px}
    .help{color:var(--muted); font-size:.9rem}
    input[type="text"], input[type="number"], input[type="email"], select, textarea{
      width:100%; background:#101217; color:var(--fg); border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:12px 14px; font-size:1rem; outline:none;
    }
    input[type="range"]{width:100%}
    textarea{min-height:92px; resize:vertical}
    .btns{display:flex; gap:10px; flex-wrap:wrap}
    button, .btn{cursor:pointer; border:0; padding:12px 16px; border-radius:12px; font-weight:700}
    .primary{background:linear-gradient(135deg,var(--brand),var(--brand2)); color:#202020}
    .ghost{background:transparent; color:var(--fg); border:1px solid rgba(255,255,255,.14)}
    .danger{background:#B00020}
    .ok{background:var(--ok); color:#0b0c10}
    .bar{height:8px; background:#20242c; border-radius:999px; overflow:hidden;}
    .bar>i{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--brand),var(--brand2)); transition:width .35s ease}
    .step{display:none}
    .step.active{display:block}
    .pill{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:#101217; border:1px solid rgba(255,255,255,.08); font-size:.9rem}
    .opt{display:flex; gap:8px; flex-wrap:wrap}
    .opt input{display:none}
    .opt label{border:1px solid rgba(255,255,255,.14); padding:10px 12px; border-radius:12px; cursor:pointer; background:#101217}
    .opt input:checked + label{outline:2px solid var(--brand); background:linear-gradient(180deg,rgba(255,213,77,.10),transparent)}
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
    .foot{margin-top:18px; font-size:.9rem}
    .success{border-color:rgba(49,196,141,.35);}
    .error{border-color:#ff6b6b}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Cheese Wonderland ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ</h1>
        <div class="muted">æ‰€è¦ <b>60ç§’</b>ï¼ˆè©³ã—ãç­”ãˆã‚‹å ´åˆ <b>3åˆ†</b>ï¼‰ï¼åŒ¿åãƒ»ä¸€éƒ¨ä»»æ„</div>
      </div>
    </header>

    <div class="card">
      <div class="bar" aria-label="é€²è¡ŒçŠ¶æ³"><i id="progress"></i></div>
      <form id="form" class="grid" novalidate>
        <!-- ğŸ”’ honeypot for spam -->
        <input type="text" name="website" autocomplete="off" class="sr-only" tabindex="-1" aria-hidden="true">
        <input type="hidden" name="timestamp" id="timestamp">
        <input type="hidden" name="detail_level" id="detail_level" value="simple">
        <input type="hidden" name="source" id="source">
        <input type="hidden" name="form_version" value="cw_v1.0">

        <!-- STEP 1: æº€è¶³åº¦ -->
        <section class="step active" data-step="1">
          <label for="csat">æœ¬æ—¥ã®æº€è¶³åº¦ï¼ˆ1ã€œ5ï¼‰</label>
          <div class="opt">
            <input type="radio" id="csat1" name="csat" value="1" required><label for="csat1">1</label>
            <input type="radio" id="csat2" name="csat" value="2"><label for="csat2">2</label>
            <input type="radio" id="csat3" name="csat" value="3"><label for="csat3">3</label>
            <input type="radio" id="csat4" name="csat" value="4"><label for="csat4">4</label>
            <input type="radio" id="csat5" name="csat" value="5"><label for="csat5">5</label>
          </div>
          <p class="help">1=ä¸æº€ / 5=ã¨ã¦ã‚‚æº€è¶³</p>
          <div class="btns"><button type="button" class="primary" data-next>æ¬¡ã¸</button></div>
        </section>

        <!-- STEP 2: NPS -->
        <section class="step" data-step="2">
          <label for="nps">æœ¬ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‹äººã«å‹§ã‚ãŸã„åº¦ï¼ˆ0ã€œ10ï¼‰</label>
          <input type="range" id="nps" name="nps" min="0" max="10" step="1" value="8" aria-describedby="npsval">
          <div id="npsval" class="pill">ç¾åœ¨ã®é¸æŠï¼š<span id="nps_out">8</span></div>
          <div class="btns">
            <button type="button" class="ghost" data-prev>æˆ»ã‚‹</button>
            <button type="button" class="primary" data-next>æ¬¡ã¸</button>
          </div>
        </section>

        <!-- STEP 3: ã‚ˆã‹ã£ãŸç‚¹ / æ”¹å–„ç‚¹ -->
        <section class="step" data-step="3">
          <label for="good_points">è‰¯ã‹ã£ãŸç‚¹ï¼ˆè‡ªç”±è¨˜è¿°ï¼‰</label>
          <textarea id="good_points" name="good_points" placeholder="ä¾‹ï¼šã€‡ã€‡ã®ãƒãƒ¼ã‚ºãŒæœ€é«˜ã€ã‚¹ã‚¿ãƒƒãƒ•ã®èª¬æ˜ãŒä¸å¯§ ãªã©"></textarea>
          <label for="improvements">æ”¹å–„ã—ã¦ã»ã—ã„ç‚¹ï¼ˆè‡ªç”±è¨˜è¿°ï¼‰</label>
          <textarea id="improvements" name="improvements" placeholder="ä¾‹ï¼šåˆ—ã®ä¸¦ã³æ–¹ã€æä¾›ã‚¹ãƒ”ãƒ¼ãƒ‰ ãªã©"></textarea>
          <div class="btns">
            <button type="button" class="ghost" data-prev>æˆ»ã‚‹</button>
            <button type="button" class="primary" data-next>æ¬¡ã¸</button>
          </div>
        </section>

        <!-- STEP 4: æ¬¡å›å‚åŠ æ„å‘ -->
        <section class="step" data-step="4">
          <label>æ¬¡å›ã‚‚å‚åŠ ã—ãŸã„ã§ã™ã‹ï¼Ÿ</label>
          <div class="opt">
            <input type="radio" id="rejoin_yes" name="rejoin" value="ã¯ã„" required><label for="rejoin_yes">ã¯ã„</label>
            <input type="radio" id="rejoin_maybe" name="rejoin" value="æœªå®š"><label for="rejoin_maybe">æœªå®š</label>
            <input type="radio" id="rejoin_no" name="rejoin" value="ã„ã„ãˆ"><label for="rejoin_no">ã„ã„ãˆ</label>
          </div>
          <div class="btns">
            <button type="button" class="ghost" data-prev>æˆ»ã‚‹</button>
            <button type="button" class="primary" id="to_detail">è©³ã—ãç­”ãˆã‚‹</button>
            <button type="button" class="ok" id="skip_detail">ã“ã®å†…å®¹ã§é€ä¿¡</button>
          </div>
          <p class="help">â€»ã€Œè©³ã—ãç­”ãˆã‚‹ã€ã§å„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è©•ä¾¡ãªã©ï¼ˆç´„2åˆ†ï¼‰</p>
        </section>

        <!-- STEP 5+: è©³ç´°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section class="step" data-step="5">
          <h3 style="margin:0 0 8px">ä¾¡æ ¼ã®ç´å¾—æ„Ÿ</h3>
          <select name="price_fairness" id="price_fairness">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option>é«˜ã™ãã‚‹</option>
            <option>ã‚„ã‚„é«˜ã„</option>
            <option>ã¡ã‚‡ã†ã©ã‚ˆã„</option>
            <option>ã‚„ã‚„å®‰ã„</option>
            <option>å®‰ã™ãã‚‹</option>
          </select>
          <div class="btns">
            <button type="button" class="ghost" data-prev>æˆ»ã‚‹</button>
            <button type="button" class="primary" data-next>æ¬¡ã¸</button>
          </div>
        </section>

        <section class="step" data-step="6">
          <label>å„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è©•ä¾¡ï¼ˆ1ã€œ5ï¼‰</label>
          <div class="grid two">
            <div>
              <span class="help">ãƒ©ã‚¯ãƒ¬ãƒƒãƒˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼</span>
              <input type="number" name="raclette" min="1" max="5" placeholder="1-5">
            </div>
            <div>
              <span class="help">ã‚·ã‚«ã‚´ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«</span>
              <input type="number" name="pizza_lab" min="1" max="5" placeholder="1-5">
            </div>
            <div>
              <span class="help">ãƒ¡ãƒ«ãƒ†ã‚£ãƒ‡ã‚£ãƒƒãƒ—ãƒãƒƒãƒˆï¼ˆãƒãƒ¼ã‚ºãƒ•ã‚©ãƒ³ãƒ‡ãƒ¥ï¼‰</span>
              <input type="number" name="roulette_fondue" min="1" max="5" placeholder="1-5">
            </div>
            <div>
              <span class="help">ãƒãƒ¼ã‚ºãƒ”ã‚¶ãƒ©ãƒœ</span>
              <input type="number" name="tasting" min="1" max="5" placeholder="1-5">
            </div>
            <div>
              <span class="help">ã‚¨ã‚¹ãƒ—ãƒ¼ãƒãƒã‚¹ã‚¯</span>
              <input type="number" name="photo_welcome" min="1" max="5" placeholder="1-5">
            </div>
            <div>
              <span class="help">æ··é›‘ã®æ„Ÿã˜æ–¹</span>
              <input type="number" name="crowding" min="1" max="5" placeholder="1-5">
            </div>
            <div>
              <span class="help">æä¾›ã‚¹ãƒ”ãƒ¼ãƒ‰</span>
              <input type="number" name="speed" min="1" max="5" placeholder="1-5">
            </div>
            <div>
              <span class="help">ã‚¹ã‚¿ãƒƒãƒ•æ¥å®¢</span>
              <input type="number" name="hospitality" min="1" max="5" placeholder="1-5">
            </div>
            <div>
              <span class="help">æ–™ç†ã®å‡ºæ¥æ „ãˆ</span>
              <input type="number" name="dish_quality" min="1" max="5" placeholder="1-5">
            </div>
          </div>
          <label for="favorites_top3">ãŠæ°—ã«å…¥ã‚Šãƒ™ã‚¹ãƒˆ3ï¼ˆè‡ªç”±è¨˜è¿°ï¼‰</label>
          <textarea id="favorites_top3" name="favorites_top3" placeholder="ä¾‹ï¼šâ‘ ã€‡ã€‡ â‘¡â–³â–³ â‘¢â–¡â–¡"></textarea>
          <div class="btns">
            <button type="button" class="ghost" data-prev>æˆ»ã‚‹</button>
            <button type="button" class="primary" data-next>æ¬¡ã¸</button>
          </div>
        </section>

        <section class="step" data-step="7">
          <label>æ¬¡å›ã®å¸Œæœ›ãƒ†ãƒ¼ãƒï¼ˆè¤‡æ•°å¯ï¼‰</label>
          <div class="opt">
            <input type="checkbox" id="theme_meat" name="next_theme" value="è‚‰ãƒ•ã‚§ã‚¹"><label for="theme_meat">è‚‰ãƒ•ã‚§ã‚¹</label>
            <input type="checkbox" id="theme_wine" name="next_theme" value="ãƒ¯ã‚¤ãƒ³&ãƒãƒ¼ã‚º"><label for="theme_wine">ãƒ¯ã‚¤ãƒ³&ãƒãƒ¼ã‚º</label>
            <input type="checkbox" id="theme_world" name="next_theme" value="ä¸–ç•Œã®ãƒãƒ¼ã‚º"><label for="theme_world">ä¸–ç•Œã®ãƒãƒ¼ã‚º</label>
            <input type="checkbox" id="theme_truffle" name="next_theme" value="ãƒˆãƒªãƒ¥ãƒ•&ãƒãƒ¼ã‚º"><label for="theme_truffle">ãƒˆãƒªãƒ¥ãƒ•&ãƒãƒ¼ã‚º</label>
            <input type="checkbox" id="theme_spicy" name="next_theme" value="è¾›ã„Ã—ãƒãƒ¼ã‚º"><label for="theme_spicy">è¾›ã„Ã—ãƒãƒ¼ã‚º</label>
            <input type="checkbox" id="theme_family" name="next_theme" value="ãƒ•ã‚¡ãƒŸãƒªãƒ¼æ˜¼"><label for="theme_family">ãƒ•ã‚¡ãƒŸãƒªãƒ¼æ˜¼</label>
            <input type="checkbox" id="theme_other" name="next_theme" value="ãã®ä»–"><label for="theme_other">ãã®ä»–</label>
          </div>
          <label for="preferred_time">é–‹å‚¬ã®å¸Œæœ›</label>
          <select id="preferred_time" name="preferred_time">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option>å¹³æ—¥å¤œ</option>
            <option>åœŸæ›œå¤œ</option>
            <option>æ—¥æ›œæ˜¼</option>
            <option>ç¥æ—¥å‰å¤œ</option>
            <option>ãã®ä»–</option>
          </select>
          <label for="preferred_price">ä¾¡æ ¼å¸¯ã®å¸Œæœ›</label>
          <select id="preferred_price" name="preferred_price">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option>2,500å††</option>
            <option>3,000å††</option>
            <option>3,500å††</option>
            <option>4,000å††</option>
            <option>5,000å††ä»¥ä¸Š</option>
          </select>
          <div class="btns">
            <button type="button" class="ghost" data-prev>æˆ»ã‚‹</button>
            <button type="button" class="primary" data-next>æ¬¡ã¸</button>
          </div>
        </section>

        <section class="step" data-step="8">
          <label for="party">åŒä¼´è€…ï¼ˆæœ€ã‚‚è¿‘ã„ã‚‚ã®ï¼‰</label>
          <select id="party" name="companion_type">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option>ã²ã¨ã‚Š</option>
            <option>ã‚«ãƒƒãƒ—ãƒ«</option>
            <option>å‹äºº</option>
            <option>å®¶æ—(å­ã©ã‚‚ã‚ã‚Š)</option>
            <option>å®¶æ—(å­ã©ã‚‚ãªã—)</option>
            <option>ãã®ä»–</option>
          </select>
          <label for="group_size">æ¥åº—äººæ•°ï¼ˆè‡ªã‚°ãƒ«ãƒ¼ãƒ—ï¼‰</label>
          <input type="number" id="group_size" name="group_size" min="1" max="20" placeholder="ä¾‹ï¼š2">
          <label for="age">å¹´ä»£</label>
          <select id="age" name="age">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option>10ä»£</option>
            <option>20ä»£</option>
            <option>30ä»£</option>
            <option>40ä»£</option>
            <option>50ä»£</option>
            <option>60ä»£ä»¥ä¸Š</option>
          </select>
          <label for="city">ãŠä½ã¾ã„ï¼ˆå¸‚ç”ºæ‘ï¼‰</label>
          <input type="text" id="city" name="city" placeholder="ä¾‹ï¼šå²é˜œå¸‚">
          <label for="consent">ã‚³ãƒ¡ãƒ³ãƒˆæ²è¼‰</label>
          <select id="consent" name="publish_consent">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option>æ²è¼‰OK(åŒ¿å)</option>
            <option>æ²è¼‰NG</option>
          </select>
          <div class="btns">
            <button type="button" class="ghost" data-prev>æˆ»ã‚‹</button>
            <button type="button" class="primary" data-next>æ¬¡ã¸</button>
          </div>
        </section>

        <section class="step" data-step="9">
          <h3 style="margin:0 0 12px">ä»»æ„ï¼šé€£çµ¡å…ˆ & ãŠçŸ¥ã‚‰ã›</h3>
          <div class="grid two">
            <div>
              <label for="name">ãŠåå‰ï¼ˆä»»æ„ï¼‰</label>
              <input type="text" id="name" name="name" autocomplete="name" placeholder="åŒ¿åå¯">
            </div>
            <div>
              <label for="email">ãƒ¡ãƒ¼ãƒ«ï¼ˆä»»æ„ï¼‰</label>
              <input type="email" id="email" name="email" autocomplete="email" placeholder="æ¬¡å›å…ˆè¡Œæ¡ˆå†…ã§ä½¿ç”¨">
            </div>
          </div>
          <label>æ¬¡å›ã®å…ˆè¡Œæ¡ˆå†…</label>
          <div class="opt">
            <input type="radio" id="priority_yes" name="priority_notice" value="å¸Œæœ›ã™ã‚‹"><label for="priority_yes">å¸Œæœ›ã™ã‚‹</label>
            <input type="radio" id="priority_no" name="priority_notice" value="å¸Œæœ›ã—ãªã„"><label for="priority_no">å¸Œæœ›ã—ãªã„</label>
          </div>
          <label for="booking_channel">äºˆç´„çµŒè·¯</label>
          <select id="booking_channel" name="booking_channel">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option>LINE</option>
            <option>Instagram</option>
            <option>çŸ¥äººç´¹ä»‹</option>
            <option>åº—é ­</option>
            <option>Googleæ¤œç´¢</option>
            <option>ãã®ä»–</option>
          </select>
          <label for="awareness_channel">ã‚¤ãƒ™ãƒ³ãƒˆã‚’çŸ¥ã£ãŸãã£ã‹ã‘</label>
          <select id="awareness_channel" name="awareness_channel">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option>LINE</option>
            <option>Instagram</option>
            <option>çŸ¥äººç´¹ä»‹</option>
            <option>åº—é ­</option>
            <option>Googleæ¤œç´¢</option>
            <option>ãã®ä»–</option>
          </select>
          <div class="btns">
            <button type="button" class="ghost" data-prev>æˆ»ã‚‹</button>
            <button type="submit" class="primary">é€ä¿¡ã™ã‚‹</button>
          </div>
        </section>
      </form>
    </div>

    <div id="result" class="card" style="display:none"></div>

    <div class="foot muted">
      åŒ¿åã§ã®ã”å”åŠ›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚å…¥åŠ›å†…å®¹ã¯æ”¹å–„ãƒ»å“è³ªå‘ä¸Šã®ç›®çš„ã§ã®ã¿åˆ©ç”¨ã—ã€å€‹äººã‚’ç‰¹å®šã™ã‚‹åˆ©ç”¨ã¯è¡Œã„ã¾ã›ã‚“ã€‚
    </div>
  </div>

  <script>
    // ====== è¨­å®šï¼šFormspree ã® endpoint ã‚’å…¥åŠ› ======
    const FORMSPREE_ENDPOINT = "https://formspree.io/f/xdkwdvvj"; // â† ã“ã“ã‚’æ›¸ãæ›ãˆ
    const THANKS_COUPON = "CW100"; // é€ä¿¡å¾Œã«è¡¨ç¤ºã™ã‚‹ç‰¹å…¸ã‚³ãƒ¼ãƒ‰ï¼ˆä»»æ„ï¼‰

    // ====== é€²è¡Œç®¡ç† ======
    const steps = Array.from(document.querySelectorAll('.step'));
    let idx = 0; // ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—indexï¼ˆ0é–‹å§‹ï¼‰
    const progress = document.getElementById('progress');

    function updateProgress(){
      const pct = Math.round(((idx+1)/steps.length)*100);
      progress.style.width = pct + '%';
    }
    function goto(i){
      steps[idx].classList.remove('active');
      idx = i; steps[idx].classList.add('active');
      updateProgress();
      // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç§»å‹•ï¼ˆã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼‰
      const firstInput = steps[idx].querySelector('input, select, textarea, button');
      if(firstInput) firstInput.focus({preventScroll:false});
      window.scrollTo({top:0, behavior:'smooth'});
    }
    document.querySelectorAll('[data-next]').forEach(b=>b.addEventListener('click', ()=>{
      // å¿…é ˆãƒã‚§ãƒƒã‚¯ï¼ˆç°¡æ˜“ï¼‰
      const required = steps[idx].querySelectorAll('[required]');
      for(const el of required){ if(el.type==='radio'){
        const name = el.name; if(!document.querySelector(`input[name="${name}"]:checked`)){ steps[idx].classList.add('error'); setTimeout(()=>steps[idx].classList.remove('error'), 800); return; }
      } else if(!el.value){ steps[idx].classList.add('error'); setTimeout(()=>steps[idx].classList.remove('error'), 800); return; } }
      goto(Math.min(idx+1, steps.length-1));
    }));
    document.querySelectorAll('[data-prev]').forEach(b=>b.addEventListener('click', ()=> goto(Math.max(idx-1, 0))));

    // è©³ç´°ã¸ / ã‚¹ã‚­ãƒƒãƒ—é€ä¿¡
    const toDetail = document.getElementById('to_detail');
    const skipDetail = document.getElementById('skip_detail');
    const detailLevel = document.getElementById('detail_level');

    toDetail.addEventListener('click', ()=>{ detailLevel.value = 'detailed'; goto(4); }); // index: 0-based â†’ step5
    skipDetail.addEventListener('click', ()=>{ detailLevel.value = 'simple'; submitForm(); });

    // NPSæ•°å€¤è¡¨ç¤º
    const nps = document.getElementById('nps');
    const nps_out = document.getElementById('nps_out');
    nps.addEventListener('input', ()=> nps_out.textContent = nps.value);

    // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ— & sourceï¼ˆURL ch / utm_sourceï¼‰
    const ts = document.getElementById('timestamp');
    ts.value = new Date().toISOString();
    const params = new URLSearchParams(location.search);
    document.getElementById('source').value = params.get('ch') || params.get('utm_source') || '';

    // ====== é€ä¿¡å‡¦ç†ï¼ˆAJAXï¼‰ ======
    const form = document.getElementById('form');
    form.addEventListener('submit', (e)=>{ e.preventDefault(); submitForm(); });

    async function submitForm(){
      const result = document.getElementById('result');
      const data = new FormData(form);

      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæœ€ä½é™ï¼šcsatå¿…é ˆï¼‰
      if(!document.querySelector('input[name="csat"]:checked')){
        idx=0; goto(0); return;
      }

      try{
        const res = await fetch(FORMSPREE_ENDPOINT, { method:'POST', body:data, headers:{ 'Accept':'application/json' }});
        if(res.ok){
          const name = data.get('name');
          document.querySelector('.card').style.display='none';
          result.style.display='block';
          result.classList.add('success');
          result.innerHTML = `
            <h2 style="margin:0 0 6px">ã”å›ç­”ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼</h2>
            <p class="muted">çš†ã•ã¾ã®å£°ã‚’ã‚‚ã¨ã«ã€æ¬¡å›ã‚’ã‚‚ã£ã¨è‰¯ãã—ã¾ã™ã€‚</p>
            <div class="pill">ç‰¹å…¸ã‚³ãƒ¼ãƒ‰ï¼š<span class="mono"><b>${THANKS_COUPON}</b></span></div>
            <p class="help">â€» æ¬¡å›ä¼šè¨ˆæ™‚ã«ã‚¹ã‚¿ãƒƒãƒ•ã¸ãŠè¦‹ã›ãã ã•ã„ï¼ˆæœŸé–“é™å®šï¼‰ã€‚</p>
            <hr style="border:0;border-top:1px solid rgba(255,255,255,.08); margin:14px 0">
            <p class="muted">ã‚‚ã—æœªé€ä¿¡ã‚„ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Œã°ã€ãƒãƒƒãƒˆæ¥ç¶šã‚’ã”ç¢ºèªã®ã†ãˆå†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚</p>
          `;
          localStorage.setItem('cw_survey_submitted','1');
        } else {
          const payload = await res.json().catch(()=>({}));
          throw new Error(payload?.error || 'é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ç½®ã„ã¦ãŠè©¦ã—ãã ã•ã„ã€‚');
        }
      } catch(err){
        alert(err.message);
      }
    }

    // æ—¢ã«é€ä¿¡æ¸ˆã¿ã®å ´åˆã®ã‚¬ãƒ¼ãƒ‰ï¼ˆä»»æ„ï¼‰
    if(localStorage.getItem('cw_survey_submitted')==='1'){
      document.querySelector('#result').style.display='block';
      document.querySelector('#result').innerHTML = `<h2>é€ä¿¡ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼</h2><p class="muted">å†åº¦å›ç­”ã•ã‚Œã‚‹å ´åˆã¯ã€ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚</p>`;
      document.querySelector('.card').style.display='none';
    }
  </script>
</body>
</html>
